# 📋 要件定義書：EZ Manual Simplifier

**プロジェクト名**: EZ Manual Simplifier  
**作成日**: 2025-10-04  
**バージョン**: 1.0  
**ステータス**: 要件定義フェーズ

---

## 🎯 1. プロジェクト概要

### 1.1 目的
GitHub Docsなどの技術マニュアルを、初心者や小学生でも理解できるように、**画像付きで分かりやすく変換**するWebアプリケーションを構築する。

### 1.2 背景
- 技術マニュアルは専門用語が多く、初心者には理解困難
- 要約ではなく、**詳細な説明を分かりやすく再構成**する必要がある
- 視覚的な補助（図解、イラスト）が学習効果を高める

### 1.3 成功基準
- ✅ 複数の入力形式に対応（URL、PDF、Markdown等）
- ✅ 分かりやすい日本語で再構築
- ✅ 適切な図解・イラストを自動生成
- ✅ コスト効率的（月額$60以下）
- ✅ 再現性の確保（同じ入力→同じ出力）
- ✅ 大容量コンテンツ対応（GitHub Docs全体など）

---

## 🔧 2. 機能要件

### 2.1 入力機能

#### 2.1.1 対応形式
| 形式 | 優先度 | 備考 |
|------|--------|------|
| URL（静的サイト） | P0 | GitHub Docs等 |
| URL（動的サイト） | P1 | SPAサイト |
| PDF | P0 | マニュアルPDF |
| Markdown | P0 | README等 |
| Word/PowerPoint | P2 | オフィス文書 |
| 画像（OCR） | P2 | スキャン文書 |
| 動画（字幕抽出） | P3 | チュートリアル動画 |

#### 2.1.2 入力方法
- ✅ URL入力フォーム
- ✅ ファイルアップロード（ドラッグ&ドロップ対応）
- ✅ バッチ入力（複数ファイル/URLの一括処理）

### 2.2 処理機能

#### 2.2.1 コンテンツ解析
- ✅ **構造解析**: 見出し、段落、リスト、コードブロック等の識別
- ✅ **重要度判定**: 初心者が理解すべき重要な概念の抽出
- ✅ **難易度評価**: 専門用語や複雑な概念の検出
- ✅ **前提知識の推定**: 読者が持つべき背景知識の特定

#### 2.2.2 コンテンツ変換
- ✅ **平易な日本語化**: 専門用語→分かりやすい説明
- ✅ **構造の再構成**: 理解しやすい順序に並び替え
- ✅ **補足説明の追加**: 「なぜ？」「どうやって？」を追加
- ✅ **具体例の生成**: 抽象的な概念を具体例で説明

#### 2.2.3 ビジュアル生成
- ✅ **図解生成**: フローチャート、システム図、手順図（Mermaid）
- ✅ **イラスト生成**: コンセプト図、アイコン（Gemini Imagen）
- ✅ **デザイン生成**: LP、UI（Gen Spark Pro - 承認制）
- ✅ **画像最適化**: 圧縮、リサイズ

### 2.3 出力機能

#### 2.3.1 出力形式
| 形式 | 優先度 | 備考 |
|------|--------|------|
| HTML（Webサイト） | P0 | メイン形式 |
| PDF | P1 | オフライン閲覧 |
| EPUB | P2 | 電子書籍 |
| Markdown | P1 | 再編集可能 |

#### 2.3.2 出力オプション
- ✅ **対象レベル選択**: 小学生/中学生/初心者/中級者
- ✅ **詳細度調整**: 簡潔版/標準版/詳細版
- ✅ **テーマ選択**: ライト/ダーク/カラフル
- ✅ **言語選択**: 日本語（優先）、英語

### 2.4 管理機能

#### 2.4.1 プロジェクト管理
- ✅ プロジェクト作成・編集・削除
- ✅ 変換履歴の管理
- ✅ バージョン管理（再生成時の履歴）

#### 2.4.2 設定管理
- ✅ APIキー管理（ユーザー側で設定）
- ✅ デフォルト変換設定
- ✅ 出力先設定

---

## ⚙️ 3. 非機能要件

### 3.1 パフォーマンス要件
| 項目 | 目標値 | 備考 |
|------|--------|------|
| 初回レスポンス | < 3秒 | UI表示まで |
| 小規模変換（< 5ページ） | < 30秒 | 処理完了まで |
| 中規模変換（5-20ページ） | < 5分 | バックグラウンド処理 |
| 大規模変換（GitHub Docs全体） | < 60分 | 並列処理 |
| 画像生成 | < 10秒/枚 | Mermaid/Imagen |

### 3.2 スケーラビリティ要件
- ✅ **水平スケーリング**: GitHub Actions並列実行（最大20並列）
- ✅ **キャッシング**: 同一入力の再利用
- ✅ **チャンク処理**: 大容量コンテンツの分割処理
- ✅ **ストリーミング**: 逐次的な結果表示

### 3.3 可用性要件
- ✅ **稼働率**: 99%以上（Cloudflare Pages依存）
- ✅ **エラー回復**: 自動リトライ（最大3回）
- ✅ **バックアップ**: R2ストレージ（自動バックアップ）

### 3.4 セキュリティ要件
- ✅ **APIキー管理**: クライアント側で管理、サーバー保存なし
- ✅ **CORS制限**: 特定ドメインのみ許可
- ✅ **レート制限**: 1ユーザーあたり10リクエスト/分
- ✅ **入力検証**: XSS、インジェクション対策

### 3.5 保守性要件
- ✅ **コードカバレッジ**: 80%以上
- ✅ **ドキュメント**: 全主要機能に説明
- ✅ **ログ**: 詳細なエラーログ、実行ログ
- ✅ **モニタリング**: Analytics統合

### 3.6 再現性要件
- ✅ **決定的ハッシュ**: 入力内容のハッシュ化
- ✅ **プロンプトバージョン管理**: プロンプトをGit管理
- ✅ **Seed固定**: 可能な場合はSeed値固定
- ✅ **監査証跡**: 変換パラメータの記録

---

## 🎨 4. ユーザーインターフェース要件

### 4.1 UI/UX原則
- ✅ **シンプル**: 3ステップで完結（入力→変換→出力）
- ✅ **直感的**: ドラッグ&ドロップ対応
- ✅ **レスポンシブ**: PC/タブレット/スマホ対応
- ✅ **アクセシブル**: WCAG 2.1 AA準拠

### 4.2 主要画面
1. **ホーム画面**: 入力形式選択、クイックスタート
2. **変換設定画面**: 詳細オプション設定
3. **進行状況画面**: リアルタイム進捗表示
4. **結果プレビュー画面**: 変換結果の確認
5. **プロジェクト一覧画面**: 過去の変換履歴

---

## 🤖 5. AI エージェント統合要件

### 5.1 エージェント構成

#### 5.1.1 オーケストレーション層
| エージェント | 役割 | アクセス権限 | コスト |
|------------|------|------------|--------|
| **GitHub Copilot Agent** | メインオーケストレーター | GitHub直接アクセス | $10/月（既契約） |
| **GitHub Actions** | タスク実行エンジン | リポジトリ、Secrets | $0（無料枠） |

#### 5.1.2 処理層
| エージェント | 役割 | アクセス権限 | コスト |
|------------|------|------------|--------|
| **Gemini Pro** | メイン処理エンジン | API経由 | $20/月（既契約） |
| **Gemini Flash** | 軽量処理 | API経由 | $0（Pro含む） |
| **Gemini Imagen** | 画像生成 | API経由 | $0（Pro含む） |

#### 5.1.3 特殊タスク層
| エージェント | 役割 | アクセス権限 | コスト |
|------------|------|------------|--------|
| **GitHub Copilot** | コード生成 | GitHub | $10/月（既契約） |
| **GPT Codex** | 大規模コード生成 | API経由 | 従量課金 |
| **Gen Spark Pro** | デザイン・リサーチ | GitHub/Cloudflare/AI Drive | $?/月（既契約） |
| **Gemini CLI** | ローカルタスク | ローカルクローン | $0（Pro含む） |

### 5.2 エージェント連携ルール
- ✅ **Cursor Chat** → **あなた（Claude）** → **GitHub Copilot Agent** → 各専門エージェント
- ✅ GitHub Copilot Agentがタスク分解・割り振り
- ✅ Gen Spark Proは承認制（暴走防止）
- ✅ 全エージェントの実行ログをGitHub Actionsで記録

---

## 💰 6. コスト要件

### 6.1 月額コスト上限
- **固定費**: $50/月（Gemini Pro、GitHub Copilot、ChatGPT Pro、Gen Spark Pro）
- **変動費**: $10/月以下（API使用量）
- **合計**: **$60/月以下**

### 6.2 コスト削減施策
- ✅ 画像生成: Gemini Imagen（$0）+ Gen Spark（$0）
- ✅ ホスティング: Cloudflare Pages（$0）
- ✅ データベース: Cloudflare D1（$0）
- ✅ ストレージ: Cloudflare R2（$0）
- ✅ CI/CD: GitHub Actions（無料枠）

---

## 🌐 7. 技術スタック要件

### 7.1 フロントエンド
| 技術 | バージョン | 理由 |
|------|-----------|------|
| React | 18+ | UIフレームワーク |
| TypeScript | 5+ | 型安全性 |
| Vite | 5+ | 高速ビルド |
| Tailwind CSS | 3+ | モダンなスタイリング |
| Zustand | 4+ | 軽量状態管理 |

### 7.2 バックエンド
| 技術 | バージョン | 理由 |
|------|-----------|------|
| Cloudflare Workers | - | エッジコンピューティング |
| Hono | 4+ | 軽量フレームワーク |
| Cloudflare D1 | - | SQLiteデータベース |
| Cloudflare R2 | - | オブジェクトストレージ |

### 7.3 AI/ML
| 技術 | バージョン | 理由 |
|------|-----------|------|
| Gemini Pro 1.5 | API | メイン処理 |
| Gemini Flash | API | 軽量処理 |
| Gemini Imagen | API | 画像生成 |

### 7.4 MCP統合
| MCP | 用途 | 実行環境 |
|-----|------|---------|
| Puppeteer MCP | Webスクレイピング | GitHub Actions |
| Fetch MCP | API取得 | GitHub Actions |
| Filesystem MCP | ファイル操作 | GitHub Actions |
| PDF Extractor MCP | PDF解析 | GitHub Actions |
| OCR Service MCP | 画像→テキスト | GitHub Actions |

### 7.5 開発ツール
| ツール | 用途 |
|--------|------|
| GitHub | バージョン管理 |
| GitHub Actions | CI/CD、オーケストレーション |
| Cursor | 開発環境（無料版） |
| VSCode | 追加開発環境 |
| Wrangler | Cloudflareデプロイ |

---

## 📊 8. データ要件

### 8.1 データモデル

#### 8.1.1 プロジェクト
```typescript
interface Project {
  id: string;                    // UUID
  name: string;                  // プロジェクト名
  description: string;           // 説明
  input_type: InputType;         // URL/File/Video
  input_source: string;          // 入力元
  status: ProjectStatus;         // pending/processing/completed/error
  created_at: Date;
  updated_at: Date;
  settings: ConversionSettings;  // 変換設定
}
```

#### 8.1.2 ドキュメント
```typescript
interface Document {
  id: string;                    // UUID
  project_id: string;            // FK
  title: string;                 // タイトル
  original_content: string;      // 元コンテンツ
  simplified_content: string;    // 変換後コンテンツ
  content_hash: string;          // 再現性用ハッシュ
  version: number;               // バージョン番号
  created_at: Date;
}
```

#### 8.1.3 バージョン
```typescript
interface Version {
  id: string;
  document_id: string;           // FK
  version_number: number;
  content: string;
  prompt_version: string;        // 使用プロンプトバージョン
  model_version: string;         // 使用モデルバージョン
  parameters: Record<string, any>; // 変換パラメータ
  created_at: Date;
}
```

### 8.2 ストレージ構成
- **D1 Database**: メタデータ、プロジェクト情報
- **R2 Storage**: 画像、生成コンテンツ、キャッシュ
- **GitHub Repository**: プロンプト、設定ファイル、バージョン管理

---

## 🔄 9. 将来拡張要件

### 9.1 フェーズ2（3-6ヶ月後）
- ✅ **多言語対応**: 英語、中国語、韓国語
- ✅ **コラボレーション**: 複数ユーザーでの編集
- ✅ **API公開**: 外部サービスからの利用

### 9.2 フェーズ3（6-12ヶ月後）
- ✅ **汎用Webサイトビルダー**: 任意のWebサイトを自動構築
- ✅ **自動バグ修正**: エラー検出と自動修正
- ✅ **深層リサーチ**: 複数ソースからの情報統合
- ✅ **完全自動デプロイ**: ワンクリックデプロイ

---

## ✅ 10. 受入基準

### 10.1 MVP（Minimum Viable Product）受入基準
- [ ] URL入力からHTML出力まで完了
- [ ] Mermaid図解が自動生成される
- [ ] Gemini Proで平易な日本語に変換される
- [ ] Cloudflare Pagesにデプロイされる
- [ ] GitHub Copilot Agentからタスク実行可能
- [ ] 変換履歴がD1に保存される
- [ ] 再変換で同じ結果が得られる（再現性）

### 10.2 品質基準
- [ ] TypeScriptのビルドエラーなし
- [ ] ESLint警告なし
- [ ] テストカバレッジ80%以上
- [ ] Lighthouse Performance 90+
- [ ] 全主要機能にドキュメント

---

## 📝 11. 制約事項

### 11.1 技術的制約
- ✅ Cursor無料版（Claude未課金）
- ✅ GitHub Actions無料枠（月2,000分）
- ✅ Cloudflare無料枠（Workers 100,000 req/day）
- ✅ iPhone環境からの操作も想定

### 11.2 運用制約
- ✅ ユーザーが自身のAPIキーを設定
- ✅ Gen Spark Proは承認制で使用
- ✅ 大規模変換は非同期処理（即座には完了しない）

### 11.3 コンテンツ制約
- ✅ 著作権遵守（変換結果は私的利用推奨）
- ✅ スクレイピングはrobots.txt準拠
- ✅ レート制限遵守

---

## 📞 12. ステークホルダー

### 12.1 プロジェクトオーナー
- **あなた（ユーザー）**: 要件定義、優先順位決定、承認

### 12.2 開発チーム
- **Claude（Cursor）**: プロジェクト管理、Issue作成、設計支援
- **GitHub Copilot Agent**: オーケストレーション、タスク分配
- **Gemini Pro**: メイン処理実装
- **Gen Spark Pro**: デザイン・リサーチ（承認制）

---

## 🎯 13. 次ステップ

1. ✅ この要件定義の承認
2. ⏭️ 設計フロー作成
3. ⏭️ タスクチェックリスト作成
4. ⏭️ 開発環境セットアップ
5. ⏭️ MVP開発開始

---

**この要件定義に対するフィードバックをお願いします。**  
**修正・追加が必要な箇所があればお知らせください。**
